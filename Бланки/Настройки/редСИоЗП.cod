Class inherited СИС2.БазовыйБланкРедактор "Настройка расчета формы СИоЗП" , editor Настройки.СИоЗП;

inclass public
inobject private

--{{ Свойства

  var секцВидНачисления: TemplateSection;

  var Интерфейс: Настройки.интСИоЗП;
  var ПравилаВыводаНачислений: ТББ_Базовый.ЧекЛист.ПравилаОформления;
--}}

--_ Конструкторы, визуализаторы. --

--_ Обработчики событий шаблона. --

--_ Обработчики событий клеток шаблона. --

  func Поле_ПриВыводе (Cell: TemplateCell; Value: Variant; Action: Template.OutputTypes; var Format: String): Variant;
    var локЧекЛистЭлемент: ТББ_Базовый.ЧекЛист.Элемент;
    if (Cell.Owner.Row[Cell.Row].Tag is ТББ_Базовый.ЧекЛист.Элемент):
      локЧекЛистЭлемент = Cell.Owner.Row[Cell.Row].Tag as ТББ_Базовый.ЧекЛист.Элемент;
      if (Cell.Contents = 'ВидНачисления'):
        Return локЧекЛистЭлемент.ОписаниеПоЗаписи(ПравилаВыводаНачислений, true);
      elsif (Cell.Contents = 'OnOff'):
        Return локЧекЛистЭлемент.OnOff as logical;
      elsif (Cell.Contents in ['ДО','ДВ','ДП','ДР','ПР']):
        Return локЧекЛистЭлемент.GetLinkData(Cell.Contents) as logical;
      fi;
    else
      if (Интерфейс <> nil):
        if (Cell.Contents = 'ШР'):
          --Return Интерфейс.ШтатноеРасписание_Имя;
        elsif (Pos('КодКатегории.',Cell.Contents) > 0):
          --Return Интерфейс.Категория_Код(Cell.Contents);
        elsif (Pos('КбкШтатнойДолжности.',Cell.Contents) > 0):
          --Return Интерфейс.КбкШтатнойДолжности_Имя;
        fi;
      fi;
    fi;
  end;

  func Поле_ПриНажатии (Cell: TemplateCell; Action: Template.ClickTypes): Logical;
    var локЧекЛистЭлемент: ТББ_Базовый.ЧекЛист.Элемент;
    if (Cell.Owner.Row[Cell.Row].Tag is ТББ_Базовый.ЧекЛист.Элемент):
      локЧекЛистЭлемент = Cell.Owner.Row[Cell.Row].Tag as ТББ_Базовый.ЧекЛист.Элемент;
      ИзменитьНастройку_ФлагВыбора(Cell, локЧекЛистЭлемент);
    fi;
  end;

--_ Обработчики событий прочих объектов шаблона. --

--_ Дополнительные команды. --

--_ Вспомогательные методы. --

  proc ИзменитьНастройку_ФлагВыбора (Cell: TemplateCell; локЧекЛистЭлемент: ТББ_Базовый.ЧекЛист.Элемент);
--    if (Cell.Contents = 'OnOff'):
--      локЧекЛистЭлемент.SetOnOff(not локЧекЛистЭлемент.OnOff);
--    elsif (Cell.Contents = 'ДО'):
--      if локЧекЛистЭлемент.GetLinkData(Cell.Contents) as logical:
--        локЧекЛистЭлемент.SetLinkData('ДО', false);
--        локЧекЛистЭлемент.SetLinkData('ДВ', false);
--        локЧекЛистЭлемент.SetLinkData('ДП', false);
--        локЧекЛистЭлемент.SetLinkData('ДР', true);
--        локЧекЛистЭлемент.SetLinkData('ПР', false);
--      else
--        локЧекЛистЭлемент.SetLinkData('ДО', true);
--        локЧекЛистЭлемент.SetLinkData('ДВ', false);
--        локЧекЛистЭлемент.SetLinkData('ДП', false);
--        локЧекЛистЭлемент.SetLinkData('ДР', false);
--        локЧекЛистЭлемент.SetLinkData('ПР', false);
--      fi;
--    elsif (Cell.Contents = 'ДВ'):
--      if локЧекЛистЭлемент.GetLinkData(Cell.Contents) as logical:
--        локЧекЛистЭлемент.SetLinkData('ДО', false);
--        локЧекЛистЭлемент.SetLinkData('ДВ', false);
--        локЧекЛистЭлемент.SetLinkData('ДП', false);
--        локЧекЛистЭлемент.SetLinkData('ДР', true);
--        локЧекЛистЭлемент.SetLinkData('ПР', false);
--      else
--        локЧекЛистЭлемент.SetLinkData('ДО', false);
--        локЧекЛистЭлемент.SetLinkData('ДВ', true);
--        локЧекЛистЭлемент.SetLinkData('ДП', false);
--        локЧекЛистЭлемент.SetLinkData('ДР', false);
--        локЧекЛистЭлемент.SetLinkData('ПР', false);
--      fi;
--    elsif (Cell.Contents = 'ДП'):
--      if локЧекЛистЭлемент.GetLinkData(Cell.Contents) as logical:
--        локЧекЛистЭлемент.SetLinkData('ДО', false);
--        локЧекЛистЭлемент.SetLinkData('ДВ', false);
--        локЧекЛистЭлемент.SetLinkData('ДП', false);
--        локЧекЛистЭлемент.SetLinkData('ДР', true);
--        локЧекЛистЭлемент.SetLinkData('ПР', false);
--      else
--        локЧекЛистЭлемент.SetLinkData('ДО', false);
--        локЧекЛистЭлемент.SetLinkData('ДВ', true);
--        локЧекЛистЭлемент.SetLinkData('ДП', true);
--        локЧекЛистЭлемент.SetLinkData('ДР', false);
--        локЧекЛистЭлемент.SetLinkData('ПР', false);
--      fi;
--    elsif (Cell.Contents = 'ДР'):
--      if локЧекЛистЭлемент.GetLinkData(Cell.Contents) as logical:
--        локЧекЛистЭлемент.SetLinkData('ДО', false);
--        локЧекЛистЭлемент.SetLinkData('ДВ', true);
--        локЧекЛистЭлемент.SetLinkData('ДП', false);
--        локЧекЛистЭлемент.SetLinkData('ДР', false);
--        локЧекЛистЭлемент.SetLinkData('ПР', false);
--      else
--        локЧекЛистЭлемент.SetLinkData('ДО', false);
--        локЧекЛистЭлемент.SetLinkData('ДВ', false);
--        локЧекЛистЭлемент.SetLinkData('ДП', false);
--        локЧекЛистЭлемент.SetLinkData('ДР', true);
--        локЧекЛистЭлемент.SetLinkData('ПР', false);
--      fi;
--    elsif (Cell.Contents = 'ПР'):
--      if локЧекЛистЭлемент.GetLinkData(Cell.Contents) as logical:
--        локЧекЛистЭлемент.SetLinkData('ДО', false);
--        локЧекЛистЭлемент.SetLinkData('ДВ', true);
--        локЧекЛистЭлемент.SetLinkData('ДП', false);
--        локЧекЛистЭлемент.SetLinkData('ДР', false);
--        локЧекЛистЭлемент.SetLinkData('ПР', false);
--      else
--        локЧекЛистЭлемент.SetLinkData('ДО', false);
--        локЧекЛистЭлемент.SetLinkData('ДВ', false);
--        локЧекЛистЭлемент.SetLinkData('ДП', false);
--        локЧекЛистЭлемент.SetLinkData('ДР', false);
--        локЧекЛистЭлемент.SetLinkData('ПР', true);
--      fi;
--    fi;
--    if (интНастройка <> nil):
--      СИС2.ФункцииДокумента.RecordModify(интНастройка.Record);
--      Модифицировать_кнСохранитьНастройку;
--    fi;
  end;

  -- модификаторы  GUI --

  proc МодифицироватьШаблон (ШаблонМодифицирован: Logical = false); -- ВИД ФОРМЫ
    Модифицировать_НастройкуРаздел1;
  end;

  proc Модифицировать_НастройкуРаздел1;
    var i, ii, c, cc: integer;
    var locIsGroup: logical;
    var locCell: TemplateCell;
--    интНастройка = Настройки.интСИоЗП.OpenForSubject(Record.НашеУчреждение);
    секцВидНачисления.RowsCount = 1;
    Интерфейс = Настройки.интСИоЗП.OpenRecord(Record); -- если еще не создан
    ii = Интерфейс.ПолучитьКоличествоВидовНачислений;
    CloneFirstRows(секцВидНачисления, ii);
    cc = секцВидНачисления.ColumnsCount;
    for i = 1 .. ii do
      секцВидНачисления.Row[i].Tag = Интерфейс.НачислениеВРасчете[i];
      locIsGroup = Интерфейс.НачислениеВРасчете[i].Record.IsGroup;
      for c = 1 .. cc do  -- перебор столбцов
        locCell = секцВидНачисления.Cell[c,i];
--        if (c in [3,5,6,7,8]): -- явное форматирование клетки чек-бокса
        if (c in [3]): -- явное форматирование клетки чек-бокса
          if locIsGroup:
            locCell.FieldType = Template.StringField;
            locCell.OnOutput = '';
            locCell.Enabled = false;
            locCell.CellType = Template.CalcFieldCell;
          else
            locCell.FieldType = Template.LogicalField;
            locCell.OnOutput = 'Поле_ПриВыводе_ОбластьНастройки';
            locCell.Enabled = true;
            locCell.CellType = Template.CalcFieldCell;
          fi;
        fi;
      od;
    od;
    Модифицировать_кнСохранитьНастройку;
  end;

  proc Модифицировать_кнСохранитьНастройку;
--      кнСохранитьНастройку.Enabled = СИС2.ФункцииДокумента.RecordIsModified(интНастройка.Record);
--      кнОтменитьНастройку.Enabled = СИС2.ФункцииДокумента.RecordIsModified(интНастройка.Record);
  end;





end